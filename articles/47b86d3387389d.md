---
title: "graphql-codegen ã‚’ä½¿ã£ã¦GraphQLã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã—ã¦ã¿ãŸ"
emoji: "ğŸŒŠ"
type: "tech"
topics: [
    "graphql",
    "frontend",
    "graphqlcodegen",
    "typescript",
    "graphqlrequest"
]
published: true
---

## ã¯ã˜ã‚ã«

sweeep Box ã§ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰(NuxtJS)ã¨BFF(GraphQLã‚µãƒ¼ãƒ)ã®é–“ã«
å·®ãŒå‡ºãªã„ã‚ˆã†ã«ã€ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã—é–‹ç™ºã—ã¦ã„ã¾ã™ã€‚
ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã—ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒä¾¿åˆ©ã ã£ãŸã®ã§ã€
ä½¿ã„æ–¹ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚
GraphQLã‚µãƒ¼ãƒ ã¯ `Go` ã§æ›¸ã„ã¦ã„ã‚‹ã®ã§ã€ä»Šå›ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´(`TypeScript`)
ã®è‡ªå‹•ç”Ÿæˆã‚’ç´¹ä»‹ã—ã¾ã™ã€‚
ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯`graphql-code-generator`ã§ã™ã€‚

https://www.graphql-code-generator.com/

`apollo-codegen` ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚‚ã‚ã£ãŸã®ã§ã™ãŒã€
äº‹ä¾‹ãŒå¤šãè¦‹ã¤ã‹ã‚Šã€è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚‚è±Šå¯Œãª `graphql-code-generator`
ã‚’é¸å®šã—ã¾ã—ãŸã€‚

https://github.com/tgriesser/apollo-codegen

## ä½¿ã„æ–¹

å°å…¥ã«ã‚ãŸã£ã¦
https://techlife.cookpad.com/entry/2021/03/24/123214
ã“ã¡ã‚‰ã®è¨˜äº‹ã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚

å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã¯ä¸‹è¨˜ã®é€šã‚Šã«ãªã‚Šã¾ã™ãƒ»

```sh
# @graphql-codegen/cli
# @graphql-codegen/import-types-preset
# @graphql-codegen/typescript-graphql-request
# @graphql-codegen/typescript-operations
# @graphql-codegen/near-operation-file-preset
# @graphql-codegen/add
# graphql-request

$npm install -D @graphql-codegen/typescript @graphql-codegen/typescript-graphql-request @graphql-codegen/typescript-operations

$npm install graphql-request
```

å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç”¨æ„ã—ãŸå¾Œã¯
è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« ã¨ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ãŒå¿…è¦ã«ãªã‚Šã¾ã™
`npx graphql-codegen` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ TypeScript ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•ã§ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

```yaml
schema: "https://raw.githubusercontent.com/marmelab/GraphQL-example/master/schema.graphql" # Graphqlã®ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«
documents: "query.graphql" # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ç™ºè¡Œã™ã‚‹ã‚¯ã‚¨ãƒªãƒ•ã‚¡ã‚¤ãƒ«
generates: # ç”Ÿæˆã«é–¢ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  graphql/types.ts:ã€€# ç”Ÿæˆå…ˆãƒ•ã‚¡ã‚¤ãƒ«
    plugins: # ä½¿ç”¨ã™ã‚‹ãƒ—ãƒ©ã‚¤ã‚°ã‚¤ãƒ³ (ç”¨é€”ã«å¿œã˜ã‚‹)
      - typescript
      - typescript-operations
      - typescript-graphql-request
```

* `schema` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã¯ å‚ç…§ã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’è¨˜å…¥ã—ã¾ã™ã€‚
`git clone` ã‚„ `git submodule` ã§ç”Ÿæˆã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç­‰ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

* `documents` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã¯ å„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ç™ºè¡Œã™ã‚‹ graphqlã®ã‚¯ã‚¨ãƒªã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’å…¥åŠ›ã—ã¾ã™ã€‚

* ä»Šå›ã®å ´åˆ `graphql/types.ts` ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

#### ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«

https://raw.githubusercontent.com/marmelab/GraphQL-example/master/schema.graphql

ã‚µãƒ³ãƒ—ãƒ«ã®ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€éƒ¨å¼•ç”¨ã—ã¾ã™ã€‚

```https://raw.githubusercontent.com/marmelab/GraphQL-example/master/schema.graphql
# å…¨ã‚³ãƒ¼ãƒ‰ã¯ç´¹ä»‹ã®éƒ½åˆä¸Šå‰²æ„›ã—ã¾ã™ã€‚
type Tweet {
  id: ID!
  # The tweet text. No more than 140 characters!
  body: String
  # When the tweet was published
  date: Date
  # Who published the tweet
  Author: User
  # Views, retweets, likes, etc
  Stats: Stat
}

type User {
  id: ID!
  username: String
  first_name: String
  last_name: String
  full_name: String
  name: String @deprecated
  avatar_url: Url
}

type Query {
  Tweet(id: ID!): Tweet
}
```

â†‘ã® GraphQL ã‚¹ã‚­ãƒ¼ãƒã«å¯¾ã—ã¦ TweetIDã‹ã‚‰ å†…å®¹ã¨ä½œè€…ã®IDã¨åå‰ã‚’å–å¾—ã™ã‚‹ã‚¯ã‚¨ãƒªã§ã™ã€‚

```query.graphql
query TweetById ($id: ID!) {
  Tweet(id: $id) {
    id
    body
    date
    Author {
        id
        username
    }
  }
}
```

#### ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«

2ã¤ã®ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ãŸä¸Šã§ `npx graphql-codegen` ã‚’å®Ÿè¡Œã™ã‚‹ã¨
```client/types.ts```ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

```client/types.ts
import { GraphQLClient } from 'graphql-request';
import * as Dom from 'graphql-request/dist/types.dom';
import gql from 'graphql-tag';
export type Maybe<T> = T | null;
export type InputMaybe<T> = Maybe<T>;
export type Exact<T extends { [key: string]: unknown }> = { [K in keyof T]: T[K] };
export type MakeOptional<T, K extends keyof T> = Omit<T, K> & { [SubKey in K]?: Maybe<T[SubKey]> };
export type MakeMaybe<T, K extends keyof T> = Omit<T, K> & { [SubKey in K]: Maybe<T[SubKey]> };
/** All built-in and custom scalars, mapped to their actual values */
export type Scalars = {
  ID: string;
  String: string;
  Boolean: boolean;
  Int: number;
  Float: number;
  Date: any;
  Url: any;
};

export type Meta = {
  __typename?: 'Meta';
  count?: Maybe<Scalars['Int']>;
};

export type Mutation = {
  __typename?: 'Mutation';
  createTweet?: Maybe<Tweet>;
  deleteTweet?: Maybe<Tweet>;
  markTweetRead?: Maybe<Scalars['Boolean']>;
};


export type MutationCreateTweetArgs = {
  body?: InputMaybe<Scalars['String']>;
};


export type MutationDeleteTweetArgs = {
  id: Scalars['ID'];
};


export type MutationMarkTweetReadArgs = {
  id: Scalars['ID'];
};

export type Notification = {
  __typename?: 'Notification';
  date?: Maybe<Scalars['Date']>;
  id?: Maybe<Scalars['ID']>;
  type?: Maybe<Scalars['String']>;
};

export type Query = {
  __typename?: 'Query';
  Notifications?: Maybe<Array<Maybe<Notification>>>;
  NotificationsMeta?: Maybe<Meta>;
  Tweet?: Maybe<Tweet>;
  Tweets?: Maybe<Array<Maybe<Tweet>>>;
  TweetsMeta?: Maybe<Meta>;
  User?: Maybe<User>;
};


export type QueryNotificationsArgs = {
  limit?: InputMaybe<Scalars['Int']>;
};


export type QueryTweetArgs = {
  id: Scalars['ID'];
};


export type QueryTweetsArgs = {
  limit?: InputMaybe<Scalars['Int']>;
  skip?: InputMaybe<Scalars['Int']>;
  sort_field?: InputMaybe<Scalars['String']>;
  sort_order?: InputMaybe<Scalars['String']>;
};


export type QueryUserArgs = {
  id: Scalars['ID'];
};

export type Stat = {
  __typename?: 'Stat';
  likes?: Maybe<Scalars['Int']>;
  responses?: Maybe<Scalars['Int']>;
  retweets?: Maybe<Scalars['Int']>;
  views?: Maybe<Scalars['Int']>;
};

export type Tweet = {
  __typename?: 'Tweet';
  Author?: Maybe<User>;
  Stats?: Maybe<Stat>;
  body?: Maybe<Scalars['String']>;
  date?: Maybe<Scalars['Date']>;
  id: Scalars['ID'];
};

export type User = {
  __typename?: 'User';
  avatar_url?: Maybe<Scalars['Url']>;
  first_name?: Maybe<Scalars['String']>;
  full_name?: Maybe<Scalars['String']>;
  id: Scalars['ID'];
  last_name?: Maybe<Scalars['String']>;
  /** @deprecated Field no longer supported */
  name?: Maybe<Scalars['String']>;
  username?: Maybe<Scalars['String']>;
};

export type TweetByIdQueryVariables = Exact<{
  id: Scalars['ID'];
}>;


export type TweetByIdQuery = { __typename?: 'Query', Tweet?: { __typename?: 'Tweet', id: string, body?: string | null | undefined, date?: any | null | undefined, Author?: { __typename?: 'User', id: string, username?: string | null | undefined } | null | undefined } | null | undefined };


export const TweetByIdDocument = gql`
    query TweetById($id: ID!) {
  Tweet(id: $id) {
    id
    body
    date
    Author {
      id
      username
    }
  }
}
    `;

export type SdkFunctionWrapper = <T>(action: (requestHeaders?:Record<string, string>) => Promise<T>, operationName: string) => Promise<T>;


const defaultWrapper: SdkFunctionWrapper = (action, _operationName) => action();

export function getSdk(client: GraphQLClient, withWrapper: SdkFunctionWrapper = defaultWrapper) {
  return {
    TweetById(variables: TweetByIdQueryVariables, requestHeaders?: Dom.RequestInit["headers"]): Promise<TweetByIdQuery> {
      return withWrapper((wrappedRequestHeaders) => client.request<TweetByIdQuery>(TweetByIdDocument, variables, {...requestHeaders, ...wrappedRequestHeaders}), 'TweetById');
    }
  };
}
export type Sdk = ReturnType<typeof getSdk>;
```

è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰`getSdk` ãŒæä¾›ã•ã‚Œã‚‹ã®ã§ã€
`graphql-request` ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¯ãƒ©ã‚¹ã‚’å¼•æ•°ã«æ¸¡ã™ã¨
æˆ»ã‚Šå€¤ã§ `TweetByIdDocument` ãŒå®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```index.ts

import { GraphQLClient } from 'graphql-request'
import { getSdk } from "./types.ts"

const BASE_GRAPHQL_ENDPOINT = "http://127.0.0.1:xxxx/graphql"

const graphQLClient = new GraphQLClient(BASE_GRAPHQL_ENDPOINT)
const sampleClient = getSdk(graphQLClient)
```

### ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

ä¾¿åˆ©ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç´¹ä»‹ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚
ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ä¸€è¦§ã¯ã“ã¡ã‚‰ã«ãªã‚Šã¾ã™ã€‚
https://www.graphql-code-generator.com/plugins/typescript-operations

```yaml
schema: "https://raw.githubusercontent.com/marmelab/GraphQL-example/master/schema.graphql"
generates:
  ./client/types.ts:
    plugins:
      - typescript
```

* `plugins` ã‚’ `typescript`ã®ã¿ã«ã™ã‚‹ã“ã¨ã§ã€Schemaã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹å‹ã ã‘ç”Ÿæˆã™ã‚‹ã“ã¨ãŒ
å¯èƒ½ã§ã™ã€‚

* è¤‡æ•°ãƒªã‚½ãƒ¼ã‚¹ã‚’æ‰±ã†å ´åˆã¯è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
ã‚¯ã‚¨ãƒªã‚¹ã‚­ãƒ¼ãƒã‚’å‚ç…§ã™ã‚‹éš›ã¯â†“ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
```typescript-operations```
```typescript-graphql-request```

```skipTypename```ã‚’ è¨­å®šã™ã‚‹ã¨ `types.ts`ã«ç”Ÿæˆã•ã‚ŒãŸå®šç¾©ã¨é‡è¤‡ã‚’é¿ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```yaml
preset: import-types
presetConfig:
  typesPath: ./types
```

ã®è¨­å®šã§å‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒ `types` ã‹ã‚‰è‡ªå‹•ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¾ã™ã€‚

ã¾ã¨ã‚ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```yaml
schema: "https://raw.githubusercontent.com/marmelab/GraphQL-example/master/schema.graphql"
generates:
  ./client/types.ts:
    plugins:
      - typescript
  ./client/tweet.ts:
    documents: "generate-code/queries/sample.graphql"
    plugins:
      - typescript-operations
      - typescript-graphql-request
    config:
      skipTypename: true
      scalars:
      Time: string
    preset: import-types
    presetConfig:
      typesPath: ./types
```

#### ãƒãƒã£ãŸç‚¹

ç”Ÿæˆã™ã‚‹åº¦ã«`linter`ã®è­¦å‘Š + `precommit` ã§ã‚¨ãƒ©ãƒ¼ãŒã—ã¾ã„
æ‰‹ã§ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨ã„ã†ãƒˆã‚¤ãƒ«ãŒç™ºç”Ÿã—ã¦ã„ã¾ã—ãŸã€‚

å¯¾ç­–ã¨ã—ã¦ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

1. ```overwrite: true``` ã§å…¨ã¦å†åº¦ä½œæˆã™ã‚‹
1. ```add``` ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã£ã¦å…¨ã¦ã®ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«ã«å…ˆé ­ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚„`import`ã‚’è¨˜è¼‰ã™ã‚‹
1. ```hooks``` ã‚’ä½¿ã£ã¦å®Ÿè¡Œå¾Œã« ç‰¹å®šã®ã‚³ãƒãƒ³ãƒ‰ `- prettier --write` ã‚’å®Ÿè¡Œã™ã‚‹
ã§è§£æ¶ˆã—ã¾ã—ãŸã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æŸ”è»Ÿã•ã«é©šæ„•ã—ã¾ã—ãŸã€‚

```yaml
overwrite: true
schema: "https://raw.githubusercontent.com/marmelab/GraphQL-example/master/schema.graphql"
definitions:
  add: &top-comment
  content: >
      /**
      * NOTE: THIS IS AN AUTO-GENERATED FILE. DO NOT MODIFY IT DIRECTLY.
      */

      /* eslint-disable */
generates:
  ./client/tweet.ts:
      documents: "generate-code/queries/sample.graphql"
      plugins:
        - typescript-operations
        - typescript-graphql-request
        - add:
            content: "import { TCustomScalar } from './customScalars'"
      config:
        skipTypename: true
        scalars:
        Time: string
      preset: import-types
      presetConfig:
        typesPath: ./types
      hooks:
        afterOneFileWrite:
        - prettier --write
```


## çµã³

è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§é–‹ç™ºé€Ÿåº¦ã®å‘ä¸Š + ãƒã‚°ã®ç™ºç”Ÿç¢ºç‡æ¸›å°‘ã‚’å®Ÿç¾ã—ã¾ã—ãŸã€‚
ç‰¹ã«ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã§ã¯è‰¯ã„UXã®æä¾›ã«é›†ä¸­ã—ãŸæ–¹ãŒã‚ˆã„ã¨æ€ã£ã¦ã„ã‚‹ã®ã§ã€ã‚µãƒ¼ãƒã¨ã®é€šä¿¡å‘¨ã‚Šã®ã‚³ãƒ¼ãƒ‰é‡å‰Šæ¸›ã‚’ã§ãã‚‹ã®ã¨ã„ã†ã“ã¨ã¯ã¨ã¦ã‚‚é–‹ç™ºè€…ä½“é¨“ãŒè‰¯ã„ã¨æ€ã„ã¾ã—ãŸã€‚
ã¾ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªç‰¹æœ‰ã®ã¨ã£ã¤ãã«ãã•ã‚‚æœ€åˆã¯ã‚ã£ãŸã‚‚ã®ã®ã€æ¯”è¼ƒçš„ã‚ã‹ã‚Šã‚„ã™ãæŸ”è»Ÿæ€§ãŒé«˜ã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã„ã†å°è±¡ã§ã™ã€‚

## æœ€å¾Œã«

å¼Šç¤¾ã§ã¯æœ¬è³ªã«å‘ãåˆã†ãŸã‚ã®åŠ¹ç‡ãƒ»è‡ªå‹•åŒ–ã«åŠ›ã‚’æ³¨ã„ã§ã„ã¾ã™ã€‚
ã‚¹ã‚­ãƒ¼ãƒé§†å‹•é–‹ç™ºãƒ»ã‚³ãƒ¼ãƒ‰è‡ªå‹•ç”Ÿæˆã‚‚ãã®ä¸€ç’°ã§ã™ã€‚
ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆä½œæˆã ã‘ã§ãªãé–‹ç™ºè€…ä½“é¨“ã®å‘ä¸Šã«èˆˆå‘³ã‚ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®æ–¹
æ˜¯éä¸€ç·’ã«åƒãã¾ã—ã‚‡ã†ï¼

https://corp.sweeep.ai/recruit
